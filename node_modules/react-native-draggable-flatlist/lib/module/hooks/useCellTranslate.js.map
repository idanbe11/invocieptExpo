{"version":3,"names":["useDerivedValue","withSpring","useAnimatedValues","useDraggableFlatListContext","useRefs","useCellTranslate","cellIndex","cellSize","cellOffset","activeIndexAnim","activeCellSize","hoverOffset","spacerIndexAnim","placeholderOffset","hoverAnim","activeKey","animationConfigRef","translate","value","isBeforeActive","isAfterActive","hoverPlusActiveSize","offsetPlusHalfSize","offsetPlusSize","result","newPlaceholderOffset","shouldTranslate","translationAmt","current"],"sources":["useCellTranslate.tsx"],"sourcesContent":["import Animated, { useDerivedValue, withSpring } from \"react-native-reanimated\";\nimport { useAnimatedValues } from \"../context/animatedValueContext\";\nimport { useDraggableFlatListContext } from \"../context/draggableFlatListContext\";\nimport { useRefs } from \"../context/refContext\";\n\ntype Params = {\n  cellIndex: Animated.SharedValue<number>;\n  cellSize: Animated.SharedValue<number>;\n  cellOffset: Animated.SharedValue<number>;\n};\n\nexport function useCellTranslate({ cellIndex, cellSize, cellOffset }: Params) {\n  const {\n    activeIndexAnim,\n    activeCellSize,\n    hoverOffset,\n    spacerIndexAnim,\n    placeholderOffset,\n    hoverAnim,\n  } = useAnimatedValues();\n\n  const { activeKey } = useDraggableFlatListContext()\n\n  const { animationConfigRef } = useRefs();\n\n  const translate = useDerivedValue(() => {\n    if (!activeKey || activeIndexAnim.value < 0) return 0\n\n    // Determining spacer index is hard to visualize. See diagram: https://i.imgur.com/jRPf5t3.jpg\n    const isBeforeActive = cellIndex.value < activeIndexAnim.value;\n    const isAfterActive = cellIndex.value > activeIndexAnim.value;\n\n    const hoverPlusActiveSize = hoverOffset.value + activeCellSize.value;\n    const offsetPlusHalfSize = cellOffset.value + cellSize.value / 2;\n    const offsetPlusSize = cellOffset.value + cellSize.value;\n    let result = -1;\n\n    if (isAfterActive) {\n      if (\n        hoverPlusActiveSize >= cellOffset.value &&\n        hoverPlusActiveSize < offsetPlusHalfSize\n      ) {\n        // bottom edge of active cell overlaps top half of current cell\n        result = cellIndex.value - 1;\n      } else if (\n        hoverPlusActiveSize >= offsetPlusHalfSize &&\n        hoverPlusActiveSize < offsetPlusSize\n      ) {\n        // bottom edge of active cell overlaps bottom half of current cell\n        result = cellIndex.value;\n      }\n    } else if (isBeforeActive) {\n      if (\n        hoverOffset.value < offsetPlusSize &&\n        hoverOffset.value >= offsetPlusHalfSize\n      ) {\n        // top edge of active cell overlaps bottom half of current cell\n        result = cellIndex.value + 1;\n      } else if (\n        hoverOffset.value >= cellOffset.value &&\n        hoverOffset.value < offsetPlusHalfSize\n      ) {\n        // top edge of active cell overlaps top half of current cell\n        result = cellIndex.value;\n      }\n    }\n\n    if (result !== -1 && result !== spacerIndexAnim.value) {\n      spacerIndexAnim.value = result;\n    }\n\n    if (spacerIndexAnim.value === cellIndex.value) {\n      const newPlaceholderOffset = isAfterActive\n        ? cellSize.value + (cellOffset.value - activeCellSize.value)\n        : cellOffset.value;\n      placeholderOffset.value = newPlaceholderOffset;\n    }\n\n    // If no active cell, translation is already 0\n    if (activeIndexAnim.value < 0) return 0;\n\n    // Active cell follows touch\n    if (cellIndex.value === activeIndexAnim.value) {\n      return hoverAnim.value\n    };\n\n    // Translate cell down if it is before active index and active cell has passed it.\n    // Translate cell up if it is after the active index and active cell has passed it.\n\n    const shouldTranslate = isAfterActive\n      ? cellIndex.value <= spacerIndexAnim.value\n      : cellIndex.value >= spacerIndexAnim.value;\n\n    const translationAmt = shouldTranslate\n      ? activeCellSize.value * (isAfterActive ? -1 : 1)\n      : 0;\n\n    return withSpring(translationAmt, animationConfigRef.current);\n  }, [activeKey]);\n\n\n  return translate;\n}\n"],"mappings":"AAAA,SAAmBA,eAAnB,EAAoCC,UAApC,QAAsD,yBAAtD;AACA,SAASC,iBAAT,QAAkC,iCAAlC;AACA,SAASC,2BAAT,QAA4C,qCAA5C;AACA,SAASC,OAAT,QAAwB,uBAAxB;AAQA,OAAO,SAASC,gBAAT,OAAuE;EAAA,IAA7C;IAAEC,SAAF;IAAaC,QAAb;IAAuBC;EAAvB,CAA6C;EAC5E,MAAM;IACJC,eADI;IAEJC,cAFI;IAGJC,WAHI;IAIJC,eAJI;IAKJC,iBALI;IAMJC;EANI,IAOFZ,iBAAiB,EAPrB;EASA,MAAM;IAAEa;EAAF,IAAgBZ,2BAA2B,EAAjD;EAEA,MAAM;IAAEa;EAAF,IAAyBZ,OAAO,EAAtC;EAEA,MAAMa,SAAS,GAAGjB,eAAe,CAAC,MAAM;IACtC,IAAI,CAACe,SAAD,IAAcN,eAAe,CAACS,KAAhB,GAAwB,CAA1C,EAA6C,OAAO,CAAP,CADP,CAGtC;;IACA,MAAMC,cAAc,GAAGb,SAAS,CAACY,KAAV,GAAkBT,eAAe,CAACS,KAAzD;IACA,MAAME,aAAa,GAAGd,SAAS,CAACY,KAAV,GAAkBT,eAAe,CAACS,KAAxD;IAEA,MAAMG,mBAAmB,GAAGV,WAAW,CAACO,KAAZ,GAAoBR,cAAc,CAACQ,KAA/D;IACA,MAAMI,kBAAkB,GAAGd,UAAU,CAACU,KAAX,GAAmBX,QAAQ,CAACW,KAAT,GAAiB,CAA/D;IACA,MAAMK,cAAc,GAAGf,UAAU,CAACU,KAAX,GAAmBX,QAAQ,CAACW,KAAnD;IACA,IAAIM,MAAM,GAAG,CAAC,CAAd;;IAEA,IAAIJ,aAAJ,EAAmB;MACjB,IACEC,mBAAmB,IAAIb,UAAU,CAACU,KAAlC,IACAG,mBAAmB,GAAGC,kBAFxB,EAGE;QACA;QACAE,MAAM,GAAGlB,SAAS,CAACY,KAAV,GAAkB,CAA3B;MACD,CAND,MAMO,IACLG,mBAAmB,IAAIC,kBAAvB,IACAD,mBAAmB,GAAGE,cAFjB,EAGL;QACA;QACAC,MAAM,GAAGlB,SAAS,CAACY,KAAnB;MACD;IACF,CAdD,MAcO,IAAIC,cAAJ,EAAoB;MACzB,IACER,WAAW,CAACO,KAAZ,GAAoBK,cAApB,IACAZ,WAAW,CAACO,KAAZ,IAAqBI,kBAFvB,EAGE;QACA;QACAE,MAAM,GAAGlB,SAAS,CAACY,KAAV,GAAkB,CAA3B;MACD,CAND,MAMO,IACLP,WAAW,CAACO,KAAZ,IAAqBV,UAAU,CAACU,KAAhC,IACAP,WAAW,CAACO,KAAZ,GAAoBI,kBAFf,EAGL;QACA;QACAE,MAAM,GAAGlB,SAAS,CAACY,KAAnB;MACD;IACF;;IAED,IAAIM,MAAM,KAAK,CAAC,CAAZ,IAAiBA,MAAM,KAAKZ,eAAe,CAACM,KAAhD,EAAuD;MACrDN,eAAe,CAACM,KAAhB,GAAwBM,MAAxB;IACD;;IAED,IAAIZ,eAAe,CAACM,KAAhB,KAA0BZ,SAAS,CAACY,KAAxC,EAA+C;MAC7C,MAAMO,oBAAoB,GAAGL,aAAa,GACtCb,QAAQ,CAACW,KAAT,IAAkBV,UAAU,CAACU,KAAX,GAAmBR,cAAc,CAACQ,KAApD,CADsC,GAEtCV,UAAU,CAACU,KAFf;MAGAL,iBAAiB,CAACK,KAAlB,GAA0BO,oBAA1B;IACD,CAnDqC,CAqDtC;;;IACA,IAAIhB,eAAe,CAACS,KAAhB,GAAwB,CAA5B,EAA+B,OAAO,CAAP,CAtDO,CAwDtC;;IACA,IAAIZ,SAAS,CAACY,KAAV,KAAoBT,eAAe,CAACS,KAAxC,EAA+C;MAC7C,OAAOJ,SAAS,CAACI,KAAjB;IACD;;IAAA,CA3DqC,CA6DtC;IACA;;IAEA,MAAMQ,eAAe,GAAGN,aAAa,GACjCd,SAAS,CAACY,KAAV,IAAmBN,eAAe,CAACM,KADF,GAEjCZ,SAAS,CAACY,KAAV,IAAmBN,eAAe,CAACM,KAFvC;IAIA,MAAMS,cAAc,GAAGD,eAAe,GAClChB,cAAc,CAACQ,KAAf,IAAwBE,aAAa,GAAG,CAAC,CAAJ,GAAQ,CAA7C,CADkC,GAElC,CAFJ;IAIA,OAAOnB,UAAU,CAAC0B,cAAD,EAAiBX,kBAAkB,CAACY,OAApC,CAAjB;EACD,CAzEgC,EAyE9B,CAACb,SAAD,CAzE8B,CAAjC;EA4EA,OAAOE,SAAP;AACD"}