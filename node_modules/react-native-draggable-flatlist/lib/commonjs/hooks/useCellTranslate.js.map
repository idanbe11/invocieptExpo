{"version":3,"names":["useCellTranslate","cellIndex","cellSize","cellOffset","useAnimatedValues","activeIndexAnim","activeCellSize","hoverOffset","spacerIndexAnim","placeholderOffset","hoverAnim","useDraggableFlatListContext","activeKey","useRefs","animationConfigRef","translate","useDerivedValue","value","isBeforeActive","isAfterActive","hoverPlusActiveSize","offsetPlusHalfSize","offsetPlusSize","result","newPlaceholderOffset","shouldTranslate","translationAmt","withSpring","current"],"sources":["useCellTranslate.tsx"],"sourcesContent":["import Animated, { useDerivedValue, withSpring } from \"react-native-reanimated\";\nimport { useAnimatedValues } from \"../context/animatedValueContext\";\nimport { useDraggableFlatListContext } from \"../context/draggableFlatListContext\";\nimport { useRefs } from \"../context/refContext\";\n\ntype Params = {\n  cellIndex: Animated.SharedValue<number>;\n  cellSize: Animated.SharedValue<number>;\n  cellOffset: Animated.SharedValue<number>;\n};\n\nexport function useCellTranslate({ cellIndex, cellSize, cellOffset }: Params) {\n  const {\n    activeIndexAnim,\n    activeCellSize,\n    hoverOffset,\n    spacerIndexAnim,\n    placeholderOffset,\n    hoverAnim,\n  } = useAnimatedValues();\n\n  const { activeKey } = useDraggableFlatListContext()\n\n  const { animationConfigRef } = useRefs();\n\n  const translate = useDerivedValue(() => {\n    if (!activeKey || activeIndexAnim.value < 0) return 0\n\n    // Determining spacer index is hard to visualize. See diagram: https://i.imgur.com/jRPf5t3.jpg\n    const isBeforeActive = cellIndex.value < activeIndexAnim.value;\n    const isAfterActive = cellIndex.value > activeIndexAnim.value;\n\n    const hoverPlusActiveSize = hoverOffset.value + activeCellSize.value;\n    const offsetPlusHalfSize = cellOffset.value + cellSize.value / 2;\n    const offsetPlusSize = cellOffset.value + cellSize.value;\n    let result = -1;\n\n    if (isAfterActive) {\n      if (\n        hoverPlusActiveSize >= cellOffset.value &&\n        hoverPlusActiveSize < offsetPlusHalfSize\n      ) {\n        // bottom edge of active cell overlaps top half of current cell\n        result = cellIndex.value - 1;\n      } else if (\n        hoverPlusActiveSize >= offsetPlusHalfSize &&\n        hoverPlusActiveSize < offsetPlusSize\n      ) {\n        // bottom edge of active cell overlaps bottom half of current cell\n        result = cellIndex.value;\n      }\n    } else if (isBeforeActive) {\n      if (\n        hoverOffset.value < offsetPlusSize &&\n        hoverOffset.value >= offsetPlusHalfSize\n      ) {\n        // top edge of active cell overlaps bottom half of current cell\n        result = cellIndex.value + 1;\n      } else if (\n        hoverOffset.value >= cellOffset.value &&\n        hoverOffset.value < offsetPlusHalfSize\n      ) {\n        // top edge of active cell overlaps top half of current cell\n        result = cellIndex.value;\n      }\n    }\n\n    if (result !== -1 && result !== spacerIndexAnim.value) {\n      spacerIndexAnim.value = result;\n    }\n\n    if (spacerIndexAnim.value === cellIndex.value) {\n      const newPlaceholderOffset = isAfterActive\n        ? cellSize.value + (cellOffset.value - activeCellSize.value)\n        : cellOffset.value;\n      placeholderOffset.value = newPlaceholderOffset;\n    }\n\n    // If no active cell, translation is already 0\n    if (activeIndexAnim.value < 0) return 0;\n\n    // Active cell follows touch\n    if (cellIndex.value === activeIndexAnim.value) {\n      return hoverAnim.value\n    };\n\n    // Translate cell down if it is before active index and active cell has passed it.\n    // Translate cell up if it is after the active index and active cell has passed it.\n\n    const shouldTranslate = isAfterActive\n      ? cellIndex.value <= spacerIndexAnim.value\n      : cellIndex.value >= spacerIndexAnim.value;\n\n    const translationAmt = shouldTranslate\n      ? activeCellSize.value * (isAfterActive ? -1 : 1)\n      : 0;\n\n    return withSpring(translationAmt, animationConfigRef.current);\n  }, [activeKey]);\n\n\n  return translate;\n}\n"],"mappings":"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"}